!function(e,a){function t(e){window.console&&console.log(e)}function r(e){return e.getFullYear()+"/"+n(e.getMonth()+1,2)+"/"+n(e.getDate(),2)}function n(e,a){for(var t=""+e;t.length<a;)t="0"+t;return t}function s(e,t){a.colorbox({html:t,title:e})}function i(){a.colorbox.resize({innerWidth:"600px",innerHeight:a(window).height()-50})}function o(){var e=a("body").css("overflow");a.colorbox.settings.onOpen=function(){a("html").css("overflow","hidden"),S=!0},a.colorbox.settings.onClosed=function(){a("html").css("overflow",e),S=!1}}function l(){var e=a("#praiseStartDate").val(),t=a("#praiseEndDate").val();_=new Date(e+" 00:00:00 +0000"),w=new Date(t+" 23:59:59 +0000");var r="Invalid Date";_.toString()===r||w.toString()===r?alert("Please enter valid start and end dates in the format yyyy/mm/dd"):_>w?alert("The end date cannot be before the start date"):(d(),i())}function c(){var e=new Date,t=new Date;t.setMonth(t.getMonth()-1);var n=r(e),i=r(t),o=["<div style='padding:1em;'>","<label for='praiseStartDate'>Start date</label><br/>","<input type='text' id='praiseStartDate' value='{startDate}' /><br/><br/>","<label for='praiseStartDate'>End date</label><br/>","<input type='text' id='praiseEndDate' value='{endDate}' /><br/><br/>","<input type='button' value='Search' id='praiseSearch' class='yj-btn' />","</div>"].join("").replace("{startDate}",i).replace("{endDate}",n);s("Praise search",o),a("#praiseSearch").on("click",l)}function d(){var e=["<div style='padding:1em; position:absolute; top:0; bottom:0; left:0; right:0; overflow-y:scroll;'>","<div id='praiseResults'></div>","<span id='praiseResultsLoading'>Loading results...</span>","<style type='text/css'>","#praiseResults .ls-praise { border: 1px solid #ddd; padding: 1em; margin-bottom:1em; }","#praiseResults .ls-praise-description { margin-bottom: 1em; }","#praiseResults .ls-praise-comment { margin-top: 1em; }","</style>","</div>"].join("");s("Praise search results",e),b()}function u(e){var t=["<div class='ls-praise'>","<div class='ls-praise-description'><strong>{description}</strong></div>","<span class='ls-praise-users'>{users}</span>","<span class='ls-praise-icon' data-icon='{icon}'></span>","<div class='ls-praise-comment'>{comment}</div>","<div><a href='{web_url}' target='_blank'>View post</a></div>","</div>"].join("");e.forEach(function(e){var r="<span class='ls-praise-user-{userId}'></span>",n=[];e.praised_user_ids.forEach(function(e){n.push(r.replace("{userId}",e))});var s=t.replace("{description}",e.description).replace("{icon}",e.icon).replace("{comment}",e.comment).replace("{users}",n.join("")).replace("{web_url}",e.web_url);a("#praiseResults").append(s)})}function p(a){var t=a.filter(function(e){var a=new Date(e.created_at);return a>=_&&w>=a}),r=m(t),n=f(r);e.Yammer.praise=e.Yammer.praise.concat(n),u(n)}function m(e){return a.map(e,function(e){return e.attachments.length>0?e.attachments:null})}function f(e){return e.filter(function(e){return"praise"===e.type})}function g(r){r=r||"";var n=D+r;a.ajax(n).done(function(r){var n=r.messages[r.messages.length-1],s=new Date(n.created_at);p(r.messages),S?s>=_?(j++,t("Getting next page of results ("+j+")"),g("&older_than="+n.id)):(t("Message loading complete"),e.Yammer.praise.length>0?a("#praiseResultsLoading").hide():a("#praiseResultsLoading").text("No praise found for that date range"),x.resolve()):t("Message loading cancelled")})}function v(e){for(var a=[],t=0,r=e.length;r>t;t++)-1===a.indexOf(e[t])&&""!==e[t]&&a.push(e[t]);return a}function h(){var t=a.map(e.Yammer.praise,function(e){return e.praised_user_ids});t=v(t);var r=["<a href='{user_url}' target='_blank'><img src='{mugshot_url}' alt='{full_name}' /></a>"].join("");t.forEach(function(t){a.ajax(y.replace("{id}",t)).done(function(n){var s=r.replace("{user_url}",n.web_url).replace("{full_name}",n.full_name).replace("{mugshot_url}",n.mugshot_url);a(".ls-praise-user-"+t).html(s),e.Yammer.praisedUsers.push(n)})})}function b(){g(),x.done(h)}var _,w,D="/api/v1/messages/attachments/13.json?filter=praise&threaded=extended&exclude_own_messages_from_unseen=true",y=window.location.pathname+"/api/v1/users/{id}.json",x=a.Deferred(),j=1,S=!1;e.Yammer={praise:[],praisedUsers:[]},o(),c()}({},window.jQuery);